// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var checked_order_id_list, confirm_checked_order_list, jq_checked_inputs, parse_order_id;
    $("thead tr th input[type='checkbox']").click(function() {
      return jq_checked_inputs().prop("checked", this.checked);
    });
    $("#confirm_handle").click(function() {
      return confirm_checked_order_list();
    });
    $("#unconfirm_handle").click(function() {
      return confirm_checked_order_list("unconfirm");
    });
    $(".btn_show_details").click(function() {
      var order_id;
      order_id = parse_order_id(this.id);
      return $("#order_details_tr_" + order_id).toggle();
    });
    confirm_checked_order_list = function(operation) {
      var order_id_list, order_id_list_str;
      if (operation == null) {
        operation = "confirm";
      }
      order_id_list = checked_order_id_list();
      order_id_list_str = JSON.stringify(order_id_list);
      return $.ajax({
        type: 'post',
        url: '/api/orders/confirm',
        data: {
          "order_id_list": order_id_list_str,
          "operation": operation,
          "_method": "PUT"
        },
        success: function(data) {
          return location.reload();
        }
      }).fail(function() {
        return alert("状态更换失败");
      });
    };
    checked_order_id_list = function() {
      var id_list;
      id_list = [];
      jq_checked_inputs('checked').each(function(index, checked_input) {
        var order_id;
        order_id = parse_order_id(checked_input.id);
        return id_list.push(order_id);
      });
      return id_list;
    };
    jq_checked_inputs = function(filter) {
      var checkboxes;
      if (filter == null) {
        filter = "";
      }
      checkboxes = $("tbody td.order_number_td input[type='checkbox']");
      if (filter !== "" && filter === "checked") {
        checkboxes = checkboxes.filter(function(index) {
          return this.checked === true;
        });
      }
      return checkboxes;
    };
    return parse_order_id = function(id) {
      return parseInt(id.split('id_')[1], 10);
    };
  });

}).call(this);
